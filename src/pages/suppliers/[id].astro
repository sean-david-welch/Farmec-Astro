---
import Layout from "../../layouts/Layout.astro";

import styles from '../../styles/Suppliers.module.css'
import utils from '../../styles/Utils.module.css'

import type Supplier from '../../types/supplier'
import type Machine from '../../types/machine'

import Machines from "../../components/server/machines.astro";
import Videos from "../../components/server/videos.astro";

import type { Video } from '../../types/video'
import { Image } from "astro:assets";

const { id } = Astro.params;

const supplier: Supplier = await fetch(`http://localhost:4321/api/suppliers/${id}`)
    .then(response => response.json())
    .then(suppliers => suppliers[0]);

const machines: Machine[] = await fetch(`http://localhost:4321/api/machines/${id}`, {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
    }
}).then(response => response.json());

const videos: Video[] = await fetch(`http://localhost:4321/api/videos/${id}`, {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
    }
}).then(response => response.json());

---

<Layout title={`Farmec | ${supplier.name}` || 'Farmec'}>
    <section id="supplierDetail">
        <div class={styles.supplierHeading}>
            <h1 class={utils.sectionHeading}>{supplier.name}</h1>

            <!-- <SocialLinks
                facebook={social_facebook}
                twitter={social_twitter}
                instagram={social_instagram}
                linkedin={social_linkedin}
                website={social_website}
                youtube={social_youtube}
            /> -->
        </div>

        <div class={utils.index}>
            <h1 class={utils.indexHeading}>Suppliers</h1>
            {machines.map(link => (
                <a href={`#${link.name}`}>
                    <h1 class="indexItem">{link.name}</h1>
                </a>
            ))}
        </div>

        <div class={styles.supplierDetail}>
            <Image
                src={supplier.marketing_image ?? '/default.jpg'}
                alt={'/dafault.jpg'}
                class={styles.supplierImage}
                width={750}
                height={750}
            />

            <p class={styles.supplierDescription}>{supplier.description}</p>

        </div>

        <Machines machines={machines} />
        <Videos videos={videos} />
    </section>
</Layout>
